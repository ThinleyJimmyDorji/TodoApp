"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const devkit_1 = require("@nrwl/devkit");
const chalk = require("chalk");
const require_shim_1 = require("./require-shim");
const packageJson = require("../../package.json");
function validateVersion(path) {
    if (packageJson.dependencies[path] ===
        require_shim_1.requireShim(`${path}/package.json`).version) {
        devkit_1.logger.warn(`Found an outdated version of ${chalk.bold(path)}\n`);
        devkit_1.logger.info(devkit_1.stripIndents `
      If you want to use webpack 5, try installing compatible versions of the plugins.
      See: https://nx.dev/guides/webpack-5
    `);
        throw new Error('Incompatible version');
    }
}
module.exports = function (onFallback) {
    try {
        validateVersion('webpack-node-externals');
    }
    catch (_a) {
        devkit_1.logger.info(`NX Falling back to webpack 4 due to incompatible plugin versions`);
        onFallback();
        return require('./bundle4')();
    }
    return {
        webpack: require_shim_1.requireShim('webpack'),
        nodeExternals: require_shim_1.requireShim('webpack-node-externals'),
        version: require_shim_1.requireShim('webpack/package.json').version,
    };
};
//# sourceMappingURL=bundle5.js.map